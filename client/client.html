<!DOCTYPE html>
<html lang="en">

<head>
  <title>MTG Design Trivia</title>
  <link rel="stylesheet" type="text/css" href="/style.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script type="text/babel">

    // update content based on response
    const displayTrivia = (xhr) => {
      const content = document.querySelector("#content");
      content.innerHTML = "";
      const obj = JSON.parse(xhr.response);
      const trivia = obj.triviaToReturn;
      console.dir(trivia);
      for(let i = 0; i < trivia.length; i++) {
        content.innerHTML = `${content.innerHTML} <p>${trivia[i].contents}</p>`;
      }
    };

    const getTrivia = (e, url, queryParams='') => {
      const xhr = new XMLHttpRequest();
      console.dir(queryParams);
      xhr.open('get', `${url}?${queryParams}`);
      xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      xhr.setRequestHeader('Accept', 'application/json');
      xhr.onload = () => displayTrivia(xhr);
      xhr.send();
      // prevent page redirection
      e.preventDefault();
      return false;
    };

    // set up button events
    const init = () => {
      const randTriviaForm = document.querySelector("#randomTriviaForm");
      const browseTriviaForm = document.querySelector("#browseTriviaForm");
      const randTriviaButton = document.querySelector("#randomTriviaButton");

      const untaggedRandTrivia = (e) => getTrivia(e, '/randomTrivia');
      const taggedRandTrivia = (e) => {
        let tag = randTriviaForm.querySelector("#randomTagSelect").value;
        getTrivia(e, '/randomTrivia', `tag=${tag}`);
      }; 
      const browseTrivia = (e) => {
        let tag = browseTriviaForm.querySelector("#browseTagSelect").value;
        let numResults = browseTriviaForm.querySelector("#numResultsSelect").value;
        getTrivia(e, '/browseTrivia', `tag=${tag}&amount=${numResults}`);
      };

      randTriviaForm.addEventListener('submit', taggedRandTrivia);
      randTriviaButton.addEventListener('click', untaggedRandTrivia);
      browseTriviaForm.addEventListener('submit', browseTrivia);
    }

    window.onload = init;
  </script>
</head>

<body>
  <section id="top">
    <h3>Get MTG Design Trivia!</h3>
    <button id="randomTriviaButton">Get Random Trivia</button> 
    <form id="randomTriviaForm">
      <input type="submit" value="Get Random Trivia with Tag" />
      <select id="randomTagSelect">
        <option value="General">General</option>
        <option value="Design">Design</option>
        <option value="Story">Story</option>
        <option value="Random">Any</option>
      </select>      
    </form>
    <form id="browseTriviaForm">
      <input type="submit" value="Browse Trivia" />
      <select id="browseTagSelect">
        <option value="General">General</option>
        <option value="Design">Design</option>
        <option value="Story">Story</option>
      </select>    
      <select id="numResultsSelect">
        <option value="1">1</option>
        <option value="5">5</option>
        <option value="10">10</option>
      </select>    
    </form>
  </section>
  <section id="content">
  </section>
  <br>
  <p>TO DO: Allow user to create problem reports and suggest trivia.</p>
</body>

</html>